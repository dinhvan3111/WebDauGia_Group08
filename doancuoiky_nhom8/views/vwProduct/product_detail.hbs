{{#section 'title'}}
    <title>Đấu giá - {{product.name}}</title>
{{/section}}
{{#section 'css'}}
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/lightslider.css">
    <link rel="stylesheet" href="/css/product_detail.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        .hidden {
            display: none;
        }

        .stars-outer {
            position: relative;
            display: inline-block;
        }

        .stars-inner {
            top: 0;
            left: 0;
            white-space: nowrap;
            overflow: hidden;
            position: absolute;
            width: 0;
        }

        .stars-outer::before {
            content: "\f005 \f005 \f005 \f005 \f005";
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            color: #ccc;
        }

        .stars-inner::before {
            content: "\f005 \f005 \f005 \f005 \f005";
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            color: #f8ce0b;
        }

        .none-product {
            width: 100%;
            text-align: center;
            font-style: italic;
        }

        .relative-product {
            height: 100%;
        }

        .link-relative-product, .link-relative-product:hover {
            text-decoration: none !important;
            color: black !important;
        }

        .relative-product h5, .relative-product h6, .relative-product span {
            font-size: 14px;
        }

        .link-relative-product img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            margin-bottom: 10px;
        }
        #confirmBiddingBtn, #confirmreBiddingBtn {
            display: none;
        }

        h5 a:hover{
            text-decoration-color: #17a2b8;
        }

    </style>
{{/section}}



<div class="container-fluid mt-2 mb-3">
    <div class="row no-gutters">
        <div class="col-md-5 pr-2">
            <div class="card">
                <div class="demo">
                    <ul id="lightSlider">
                        {{#if product.img}}
                            <li data-thumb="../img/products/{{product.id}}/thumb/{{product.img.thumb}}"><img
                                    src="../img/products/{{product.id}}/thumb/{{product.img.thumb}}"/></li>
                            {{#each product.img.imgsExtra}}
                                <li data-thumb="../img/products/{{this}}"><img src="../img/products/{{this}}"/></li>

                            {{/each}}
                        {{/if}}
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-7">
            <div class="card">

                <div class="about">
                    <h2><span class="font-weight-bold">{{product.name}}</span></h2>
                    <h5 class="font-weight-bold mt-4">Bước giá: <span class="ml-2 text-success">{{format_number
                            product.step_price}} VNĐ</span></h5>
                    {{#if product.priceSold}}
                        <h5 class="font-weight-bold mt-4">Đã bán với giá: <span class="ml-2 text-danger">{{format_number
                                product.priceSold}} VNĐ</span></h5>
                        {{#if canEdit}}
                            {{#if priceHolder}}
                                {{#if this.isRating}}
                                    <h5 class="font-weight-bold mt-4">Người chiến thắng:<a href="/profile/{{priceHolder.id}}"><span class="ml-2 text-info">{{priceHolder.name}}</span></a><a href="/rating/{{priceHolder.id}}"><span class="ml-2 text-info">({{priceHolder.upVoteRatio}}% đánh giá tốt)</span></a></h5>
                                {{else}}
                                    <h5 class="font-weight-bold mt-4">Người chiến thắng:<a href="/profile/{{priceHolder.id}}"><span class="ml-2 text-info">{{priceHolder.name}}</span></a><span class="ml-2 text-info">(Chưa có đánh giá)</span></h5>
                                {{/if}}
                            {{else}}
                                <h5 class="font-weight-bold mt-4">Người chiến thắng: <span class="ml-2 text-muted">Không có</span></h5>
                            {{/if}}
                        {{else}}
                            {{#if priceHolder}}
                                {{#if this.isRating}}
                                    <h5 class="font-weight-bold mt-4">Người chiến thắng:<span class="ml-2 text-info">{{priceHolder.mask_name}}</span><span class="ml-2 text-info">({{priceHolder.upVoteRatio}}% đánh giá tốt)</span></h5>
                                {{else}}
                                    <h5 class="font-weight-bold mt-4">Người chiến thắng:<span class="ml-2 text-info">{{priceHolder.mask_name}}</span><span class="ml-2 text-info">(Chưa có đánh giá)</span></h5>
                                {{/if}}
                            {{else}}
                                <h5 class="font-weight-bold mt-4">Người chiến thắng: <span class="ml-2 text-muted">Không có</span></h5>
                            {{/if}}
                        {{/if}}
                    {{else}}
                        <h5 class="font-weight-bold mt-4">Giá hiện tại: <span class="ml-2 text-success">{{format_number
                                product.price}} VNĐ</span>
                            <input hidden type="number" id="inPrice" value="{{product.price}}">
                            <input hidden type="number" id="stepPrice" value="{{product.step_price}}">

                        </h5>
                        {{#if canEdit}}
                            {{#if priceHolder}}
                                {{#if priceHolder.isRating}}
                                    <h5 class="font-weight-bold mt-4">Người giữ giá hiện tại: <a href="/profile/{{priceHolder.id}}"><span class="ml-2 text-info">{{priceHolder.name}}</span></a><a href="/rating/{{priceHolder.id}}"><span class="ml-2 text-info">({{priceHolder.upVoteRatio}}% đánh giá tốt)</span></a></h5>
                                {{else}}
                                    <h5 class="font-weight-bold mt-4">Người giữ giá hiện tại: <a href="/profile/{{priceHolder.id}}"><span class="ml-2 text-info">{{priceHolder.name}}</span></a><span class="ml-2 text-info">(Chưa có đánh giá)</span></h5>
                                {{/if}}
                            {{else}}
                                <h5 class="font-weight-bold mt-4">Người giữ giá hiện tại: <span class="ml-2 text-muted">Chưa có người nào giữ giá</span>
                                </h5>
                            {{/if}}
                        {{else}}
                            {{#if priceHolder}}
                                {{#if priceHolder.isRating}}
                                    <h5 class="font-weight-bold mt-4">Người giữ giá hiện tại: <span
                                            class="ml-2 text-info">{{priceHolder.mask_name}}</span><span class="ml-2 text-info">({{priceHolder.upVoteRatio}}% đánh giá tốt)</span></h5>
                                {{else}}
                                    <h5 class="font-weight-bold mt-4">Người giữ giá hiện tại: <span
                                            class="ml-2 text-info">{{priceHolder.mask_name}}</span><span class="ml-2 text-info">(Chưa có đánh giá)</span></h5>
                                {{/if}}
                            {{else}}
                                <h5 class="font-weight-bold mt-4">Người giữ giá hiện tại: <span class="ml-2 text-muted">Chưa có người nào giữ giá</span>
                                </h5>
                            {{/if}}
                        {{/if}}
                        {{#if product.buy_now_price}}
                            <h5 class="font-weight-bold mt-4">Giá mua ngay: <span
                                    class="ml-2 text-danger">{{format_number product.buy_now_price}} VNĐ</span>
                                <input hidden type="number" id="buyNowPrice" value="{{product.buy_now_price}}">
                            </h5>
                        {{/if}}

                    {{/if}}
                </div>
                <div class="buttons">
                    <div class="form-row">
                        {{#if lcAuthUser.user}}
                            {{#if canEdit}}
                                <button class="btn bg-warning btn-long mb-2 mr-2"
                                        onclick="location.href='/products/appendDes?id={{product.id}}'">
                                <i class="fa fa-pencil-square-o"></i> Thêm mô tả
                                </button>
                            {{else}}
                                {{#if product.not_sold}}

                                    {{#if ignored}}
                                        <button class="btn bg-warning mr-2 mb-2 btn-long disabled">
                                            <i class="fa fa-ban"></i> Bạn đã bị từ chối ra giá
                                        </button>
                                    {{else}}

                                        {{#if notEnoughVotes}}

                                            <button class="btn bg-warning btn-long mr-2 disabled">
                                                <i class="fa fa-ban"></i> Điểm đánh giá tích cực của bạn phải trên 80%
                                            </button>
                                        {{else}}

                                            {{#if product.buy_now_price}}
                                                {{#if canBid}}

                                                    <form id="frmBuyNow" action="{{product.id}}/buy-now" method="post">
                                                    </form>


                                                    <button class="btn bg-warning btn-long mr-2 mb-2"
                                                            data-toggle="modal" data-target="#buyNowModal">
                                                        <i class="fa fa-money"></i> Mua ngay
                                                    </button>
                                                    <!-- Modal -->
                                                    <div class="modal fade" id="buyNowModal" tabindex="-1"
                                                         aria-labelledby="buyNowModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="buyNowModalLabel">Mua
                                                                        ngay</h5>
                                                                    <button type="button" class="close"
                                                                            data-dismiss="modal" aria-label="Close">
                                                                        <span aria-hidden="true">&times;</span>
                                                                    </button>
                                                                </div>
                                                                <div class="modal-body modal-body-buyNow">
                                                                    Bạn muốn mua ngay với giá {{format_number
                                                                        product.buy_now_price}} (VNĐ) ?
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary"
                                                                            data-dismiss="modal">Hủy
                                                                    </button>
                                                                    <button type="button" class="btn btn-warning"
                                                                            id="confirmBuyNowBtn">Mua ngay
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>





                                                {{/if}}
                                            {{/if}}
                                        {{/if}}
                                        {{#if isHoldingPrice}}
                                            <button class="btn bg-warning mb-2 mr-2 disabled">
                                                <i class="fa fa-money"></i> Giá tối đa của bạn: {{format_number
                                                    max_bid_price}} (VNĐ)
                                            </button>
                                            <button id="rebiddingBtn" type="button"
                                                    class="btn bg-success btn-long text-white mb-2 mr-2"
                                                    data-toggle="modal" data-target="#rebidModal">
                                                <i class="fa fa-gavel"></i> Đặt lại giá
                                            </button>
                                            <button id="confirmreBiddingBtn" type="button" class="btn btn-primary"
                                                    data-toggle="modal" data-target="#confirmreBidding">
                                                Xác nhận
                                            </button>
                                        {{else}}

                                            {{#if notEnoughVotes}}

                                            {{else}}
                                                {{#if canBid}}
                                                    <!-- Button trigger modal -->
                                                    <button type="button" id="biddingBtn"
                                                            class="btn bg-success btn-long text-white mb-2 mr-2"
                                                            data-toggle="modal" data-target="#bidModal">
                                                        <i class="fa fa-gavel"></i> Đấu giá
                                                    </button>
                                                    <button id="confirmBiddingBtn" type="button" class="btn btn-primary"
                                                            data-toggle="modal" data-target="#confirmBidding">
                                                        Xác nhận
                                                    </button>

                                                {{else}}

                                                    <button class="btn bg-warning mr-2 mb-2 disabled">
                                                        <i class="fa fa-gavel"></i> Mở đấu giá trong: {{startDate}}
                                                    </button>

                                                {{/if}}
                                            {{/if}}
                                        {{/if}}
                                    {{/if}}
                                {{else}}
                                    {{#if isHoldingPrice}}
                                        <button class="btn bg-success mr-2 mb-2 btn-long disabled">
                                            <i class="fa fa-check"></i> Bạn đã thắng sản phẩm này
                                        </button>
                                    {{/if}}
                                {{/if}}
                            {{/if}}
                            {{#if inWatchList}}
                                <button class="btn btn-outline-danger mb-2 mr-2" disabled>
                                    <i class="fa fa-heart"></i> Đã yêu thích
                                </button>
                            {{else}}
                                <form action="add-to-watch-list" method="post">
                                    <input type="text" name="id" value="{{product.id}}" hidden/>
                                    <button class="btn btn-outline-danger mb-2 mr-2">
                                        <i class="fa fa-heart"></i> Yêu thích
                                    </button>
                                </form>
                            {{/if}}
                        {{else}}

                            <a href="/login?from='products/{{product.id}}'">
                                <button class="btn btn-outline-danger">
                                    <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Đăng nhập để đấu giá
                                </button>
                            </a>

                        {{/if}}</div>
                </div>
                <hr>
                <div class="product-description">
                    <div class="d-flex flex-row align-items-center">
                        <h5 class="card-title">
                            <i class="fa fa-calendar-check-o"></i>
                            Mở bán vào: <span class="text-success">{{product.time_start}}</span>
                        </h5>
                    </div>
                    <div class="d-flex flex-row align-items-center">
                        <h5 class="card-title">
                            <i class="fa fa-calendar-times-o" aria-hidden="true"></i></i>
                            Đóng vào lúc: <span class="text-danger">{{product.time_end}}</span>
                        </h5>
                    </div>
                    <br>
                    <div class="mt-2"><span class="font-weight-bold">Người bán</span></div>
                    <div class="d-flex flex-row align-items-center">
                        <a href="/profile/{{seller.id}}">
                            <img src="https://i.imgur.com/N2fYgvD.png" class="rounded-circle store-image"></a>

                        <div class="d-flex flex-column ml-1 comment-profile">
                            <div class="comment-ratings">
                                <div class="stars-outer">
                                    <div class="stars-inner" style="width: {{seller.starPercentageRounded}}"></div>
                                </div>
                            </div>
                            <a href="/profile/{{seller.id}}"><span class="username">{{seller.name}}</span></a>
                            <a href="/rating/{{seller.id}}">
                                {{#if (isNotRating seller.starPercentage)}}
                                    <div><small class="followers">Chưa có lượt đánh giá nào</small></div>
                                {{else}}
                                    <div><small class="followers">Có {{roundFloat seller.starPercentage}}% lượt đánh giá
                                        tốt</small></div>
                                {{/if}}
                            </a>
                        </div>
                    </div>
                    <br>
                    <div class=" mt-2"><span class="font-weight-bold">Mô tả</span>
                        <p>{{{product.description}}}</p>
                    </div>
                    <div class="bid-history card mt-5">
                        <div class="card-header bg-dark text-white">
                            <h5>Lịch sử đấu giá của sản phẩm</h5>
                        </div>
                        {{#if canEdit}}
                            <div class="modal fade" id="ignoreBidderModal" tabindex="-1" role="dialog"
                                 aria-labelledby="ignoreBidderModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="ignoreBidderModalLabel">Từ chối ra giá</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            Bạn chắn chắn muốn từ chối lượt ra giá của người này
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng
                                            </button>
                                            <button type="button" class="btn btn-primary"
                                                    onclick="javascript:$('#frmIgnoreBidder').submit();"><i
                                                    class="fa fa-check" aria-hidden="true"></i> Đồng ý
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <form id="frmIgnoreBidder" action="{{product.id}}/ignore" method="post">
                                <input hidden type="text" id="id_bidder" name="id_bidder" val/>
                            </form>
                        {{/if}}
                        {{#if bidHistory}}
                            <table class="table table-hover border">
                                <thead>
                                <tr>
                                    <th scope="col">Thời gian</th>
                                    <th scope="col">Người ra giá</th>
                                    <th scope="col">Giá</th>
                                    <th scope="col">Điểm đánh giá</th>
                                    {{#if canEdit}}
                                        <th scope="col"></th>
                                    {{/if}}
                                </tr>
                                </thead>
                                <tbody>


                                {{#each bidHistory}}

                                    <tr class="">
                                        <td>{{this.time}}</td>
                                        {{#if ../canEdit}}
                                            <td><a href="/profile/{{bidder_id}}">{{this.bidder_name}}</a></td>
                                        {{else}}
                                            <td>{{this.mask_name}}</td>
                                        {{/if}}
                                        <td>{{format_number this.in_bid_price}} VNĐ</td>
                                        <td>
                                            <div class="stars-outer">
                                                <div class="stars-inner"
                                                     style="width:{{this.starPercentageRounded}};"></div>
                                            </div>
                                            {{#if ../canEdit}}
                                                {{#if (isNotRating this.ratio)}}
                                                    <span class="ratio ml-1 ">Chưa có đánh giá</span>
                                                {{else}}
                                                    <span class="ratio ml-1 "><a href="/rating/{{bidder_id}}">{{roundFloat this.starPercentage}}% đánh giá tốt</a></span>
                                                {{/if}}
                                            {{else}}
                                                {{#if (isNotRating this.ratio)}}
                                                    <span class="ratio ml-1 ">Chưa có đánh giá</span>
                                                {{else}}
                                                    <span class="ratio ml-1 ">{{roundFloat this.starPercentage}}% đánh giá tốt</span>
                                                {{/if}}
                                            {{/if}}
                                        </td>

                                        {{#if ../canEdit}}
                                            <td>
                                                <button class="btn bg-warning" data-toggle="modal"
                                                        data-target="#ignoreBidderModal"
                                                        onclick="setIDBidder({{bidder_id}})">
                                                    <i class="fa fa-times"></i></button>
                                            </td>
                                        {{/if}}
                                    </tr>
                                {{/each}}
                                <tr>
                                    <td colspan="5" id="bid-history-more" class="bg-dark text-white text-center"
                                        style="cursor: pointer">
                                        <i class="fa fa-caret-down" aria-hidden="true"></i>
                                        Xem thêm
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="5" id="bid-history-close" class="bg-dark text-white text-center"
                                        style="cursor: pointer">
                                        <i class="fa fa-caret-up" aria-hidden="true"></i>
                                        Thu gọn
                                    </td>
                                </tr>

                                </tbody>
                            </table>
                        {{else}}
                            <div class="card-header bg-gray text-black">
                                <span style="font-size: 14px">Chưa có ai ra giá cho sản phẩm này</span>
                            </div>
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row no-gutters">
        <div class="card mt-2 w-100"><h5>Sản phẩm liên quan:</h5>
            <div class="card-body">
                <div class="row">
                    {{#if relativeProducts.length}}
                        {{#each relativeProducts}}
                            <div class="top-product-item col-sm-6 mt-3 col-lg-3 col-xl">
                                <a class="link-relative-product" href="{{id}}">
                                    <div class="card relative-product">

                                        {{#if isNew}}
                                            <div class="new-product text-white"><i class="fa fa-fire"
                                                                                   aria-hidden="true"></i>
                                                Vừa mở đấu giá
                                            </div>
                                        {{/if}}
                                        <div class="card-body">
                                            <a class="link-relative-product" href="/products/{{id}}">
                                                <img src="/img/products/{{id}}/thumb/{{img.thumb}}" alt="Sản phẩm">
                                                <h5 class="card-title">{{name}}</h5>
                                                <h6 class="card-title">Giá hiện tại: <span
                                                        class="text-success">{{format_number price}} VNĐ</span></h6>
                                                {{#if buy_now_price}}
                                                    <h6 class="card-title">Giá mua ngay: <span
                                                            class="text-danger">{{format_number buy_now_price}}
                                                        VNĐ</span></h6>
                                                {{/if}}
                                                <h6 class="card-title">Đăng vào lúc: <span
                                                        class="text-info">{{time_start}}</span></h6>
                                                {{#if price_color}}
                                                    <h6 class="card-title">Đóng vào lúc: <span
                                                            class="text-info">{{time_end}}</span></h6>
                                                {{else}}
                                                    <h6 class="card-title">Đóng vào lúc: <span
                                                            class="text-danger">{{time_end}}</span></h6>
                                                {{/if}}
                                                {{#if priceHolder}}
                                                    <h6 class="card-title">Người giữ giá hiện tại: <span
                                                            class="text-info">{{priceHolder}}</span></h6>
                                                {{else}}
                                                    <h6 class="card-title">Người giữ giá hiện tại: <span
                                                            class="text-muted">Chưa có</span></h6>
                                                {{/if}}
                                                {{#if bidHistory.length}}
                                                    <h6 class="card-title">Số lượt ra giá: <span
                                                            class="text-info">{{bidHistory.length}}</span></h6>
                                                {{else}}
                                                    <h6 class="card-title">Số lượt ra giá: <span
                                                            class="text-muted">Chưa có lượt ra giá nào</span></h6>
                                                {{/if}}
                                            </a>
                                        </div>
                                        <!--                        Modal-->
                                        <form id="frmComment" action="/products/comment" method="post">
                                            <input type="hidden" id="txtProID" name="id_product" value="">
                                            {{#if isSold}}
                                                <input type="hidden" id="txtIdSeller" name="id_assessor" value="">
                                                <input type="hidden" id="txtIdBidder" name="id_acc" value="">
                                            {{else}}
                                                <input type="hidden" id="txtIdSeller" name="id_acc" value="">
                                                <input type="hidden" id="txtIdBidder" name="id_assessor" value="">
                                            {{/if}}
                                            {{#if @root/isWon}}
                                                <input type="hidden" id="txtIdSeller" name="id_acc" value="">
                                                <input type="hidden" id="txtIdBidder" name="id_assessor" value="">
                                            {{/if}}

                                            <div class="modal fade" id="commentModal" tabindex="-1"
                                                 aria-labelledby="commentModalLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="commentModalLabel">Đánh giá của
                                                                bạn về sản phẩm </h5>
                                                            <button type="button" class="close"
                                                                    data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>


                                                        <div class="modal-body">
                                                            <input type="text" name="comment"
                                                                   id="comment"
                                                                   placeholder="Nhập đánh giá của bạn..."
                                                                   data-type="currency" value required/>
                                                            <div class="react-group m-2 d-flex">
                                                                <div class="mr-3">
                                                                    <label for="like"><i
                                                                            class="reactbtn fa fa-thumbs-o-up"></i></label>
                                                                    <input id="like" class="mt-10" name="mark"
                                                                           type="radio" value="1" checked
                                                                           required="required"/>&nbspThích
                                                                </div>
                                                                <div>
                                                                    <label for="dislike"><i
                                                                            class="reactbtn fa fa-thumbs-o-down"></i></label>
                                                                    <input id="dislike" name="mark" type="radio"
                                                                           value="0" required="required"/>&nbsp Không
                                                                    thích
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                    data-dismiss="modal">Đóng
                                                            </button>
                                                            <a href="javascript:;">
                                                                <button type="button" id="commentBtn"
                                                                        class="btn btn-success"><i
                                                                        class="fa fa-comments"></i> Đánh giá
                                                                </button>
                                                            </a>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>


                                        </form>
                                        {{#if isSeller}}
                                            <div class="card-footer text-muted">
                                                {{#if isSold}}
                                                    {{#if isSellerComment}}
                                                        <button class="btn btn-sm btn-outline-secondary" disabled>
                                                            <i class="fa fa-check" aria-hidden="true"></i>
                                                            Đã đánh giá
                                                        </button>
                                                    {{else}}
                                                        <button data-id-win-bidder="{{id_win_bidder}}"
                                                                data-id-seller="{{id_seller}}" data-id="{{id}}"
                                                                type="submit" data-toggle="modal"
                                                                data-target="#commentModal"
                                                                class="btn btn-sm btn-outline-info comment-btn"><i
                                                                class="fa fa-star"
                                                                aria-hidden="true"></i> Đánh giá ngay
                                                        </button>
                                                        <a data-toggle="modal" data-target="#cancelModal"
                                                           class="btn btn-sm btn-outline-danger" href="javascript:;"
                                                           role="button">
                                                            <i class="fa fa-ban" aria-hidden="true"></i>
                                                            Hủy giao dịch
                                                        </a>
                                                        <form id="frmCancel"
                                                              action="/products/{{id}}/cancel-transaction"
                                                              method="post">
                                                        </form>
                                                    {{/if}}
                                                {{else}}
                                                    <a class="btn btn-sm btn-success" href="/products/{{id}}">
                                                        <i class="fa fa-eye" aria-hidden="true"></i>
                                                        Xem chi tiết
                                                    </a>
                                                {{/if}}

                                            </div>
                                        {{else}}
                                            <div class="card-footer text-muted">
                                                {{#if isWatchList}}
                                                    <button class="btn btn-sm btn-outline-danger mt-2" disabled>
                                                        <i class="fa fa-heart" aria-hidden="true"></i>
                                                        Đã yêu thích
                                                    </button>
                                                {{else}}
                                                    <button proID="{{id}}"
                                                            class="btn btn-sm btn-outline-danger btn-like mt-2">
                                                        <i class="fa fa-heart" aria-hidden="true"></i>
                                                        Yêu thích

                                                    </button>
                                                    <form id="frmLike" action="/products/like" method="post">
                                                        <input id="txtLike" type="hidden" name="value_id_pro" value="">
                                                    </form>
                                                    <!--                                                        <a class="btn btn-sm btn-outline-danger" href="javascript:;" role="button">-->
                                                    <!--                                                            <i class="fa fa-heart" aria-hidden="true"></i>-->
                                                    <!--                                                            Yêu thích-->
                                                    <!--                                                        </a>-->
                                                {{/if}}


                                            </div>
                                        {{/if}}


                                    </div>
                                    <!--                                </div>-->
                                </a>
                            </div>
                        {{/each}}
                    {{else}}
                        <p class="none-product">Không có sản phẩm khác cùng danh mục</p>
                    {{/if}}

                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="isWinner" value="{{isWinner}}">
    <!-- Modal -->
    <div class="modal fade" id="bidModal" tabindex="-1"
         aria-labelledby="bidModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bidModalLabel">Nhập giá
                        tối đa bạn muốn đặt</h5>
                    <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="frmBidding" action="{{product.id}}/bidding"
                      method="post">
                    <div class="modal-body">
                        <input type="text" name="max_bid_price"
                               id="max_bid_price"
                               placeholder="(VNĐ) {{format_number
                                       product.price}}"
                               data-type="currency" value required>
                        <input hidden type="text" name="id_product"
                               id="id_product" value="{{product.id}}"
                               required>
                        <p id="dangerMaxBidPrice"
                           style="color: red"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                                data-dismiss="modal">Đóng
                        </button>
                        <a href="javascript: $('#frmBidding').submit();">
                            <button type="button"
                                    class="btn btn-success"><i
                                    class="fa fa-gavel"></i> Đặt giá
                            </button>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!--    Modal reBid-->
    <div class="modal fade" id="rebidModal" tabindex="-1"
         aria-labelledby="rebidModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="rebidModalLabel">Nhập giá
                        tối đa bạn muốn đặt</h5>
                    <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="frmreBidding" action="{{product.id}}/rebidding"
                      method="post">
                    <div class="modal-body">
                        <input type="text" name="max_bid_price"
                               id="remax_bid_price"
                               placeholder="(VNĐ) {{format_number
                                       product.price}}"
                               data-type="currency" value required>
                        <input hidden type="text" name="id_product"
                               id="id_product" value="{{product.id}}"
                               required>
                        <p id="dangerMaxReBidPrice"
                           style="color: red"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                                data-dismiss="modal">Đóng
                        </button>
                        <a href="javascript: $('#frmreBidding').submit();">
                            <button type="button"
                                    class="btn btn-success"><i
                                    class="fa fa-gavel"></i> Đặt giá
                            </button>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="confirmBidding" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Xác nhận</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Giá đặt tối đa vừa nhập là <span id="maxPrice"></span>. Bạn có muốn đặt với giá này không ?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="back" class="btn btn-secondary" data-dismiss="modal">Quay lại</button>
                    <button type="button" id="confirm" class="btn btn-success">Xác nhận</button>
                </div>
            </div>
        </div>
    </div>
    <div id="confirmreBidding" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Xác nhận</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Giá đặt tối đa vừa nhập là <span id="maxReBidPrice"></span>. Bạn có muốn đặt lại với giá này
                        không ?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="backrebid" class="btn btn-secondary" data-dismiss="modal">Quay lại
                    </button>
                    <button type="button" id="confirmrebid" class="btn btn-success">Xác nhận</button>
                </div>
            </div>
        </div>
    </div>
</div>
{{#section 'js'}}
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js'></script>
    <script src='https://sachinchoolur.github.io/lightslider/dist/js/lightslider.js'></script>
    <script>
        $('#lightSlider').lightSlider({
            gallery: true,
            item: 1,
            loop: true,
            slideMargin: 0,
            thumbItem: 6
        });
    </script>

    <script>
        $('#confirm').on('click', function (e) {
            $('#frmBidding').off('submit').submit();
        })
        $('#back').on('click', function (e) {
            $('#biddingBtn').click();
        })
        $('#confirmrebid').on('click', function (e) {
            $('#frmreBidding').off('submit').submit();
        })
        $('#backrebid').on('click', function (e) {
            $('#rebiddingBtn').click();
        })
        $('#frmBidding').on('submit', function (e) {
            e.preventDefault();
            var max_bid_price = $('#max_bid_price').val();
            $('#maxPrice')[0].innerText = max_bid_price;
            if (max_bid_price === '' || max_bid_price === '(VNĐ) ') {
                $('#dangerMaxBidPrice').html('Vui lòng nhập giá bạn muốn đặt');
            } else {
                let buyNowPrice = $('#buyNowPrice').val();
                let inPrice = $('#inPrice').val();
                let stepPrice = $('#stepPrice').val();
                max_bid_price = max_bid_price.split(' ')[1].replace(/,/g, '');
                if (max_bid_price < parseInt(inPrice) + parseInt(stepPrice)) {

                    $('#dangerMaxBidPrice').html('Chưa đủ mức giá tối thiểu để vào sản phẩm này');
                    return;
                } else if (max_bid_price >= parseInt(buyNowPrice)) {
                    $('#dangerMaxBidPrice').html('Với mức giá này xin mời bạn mua ngay sản phẩm');
                    return;
                } else if (max_bid_price % parseInt(stepPrice) != 0) {
                    $('#dangerMaxBidPrice').html('Vui lòng nhập giá tối đa phải bằng bội số của bước giá');
                    return;
                }
                $('#biddingBtn').click();
                $('#confirmBiddingBtn').click();
            }

        });
        $('#frmreBidding').on('submit', function (e) {
            e.preventDefault();
            var max_bid_price = $('#remax_bid_price').val();
            $('#maxReBidPrice')[0].innerText = max_bid_price;
            if (max_bid_price === '' || max_bid_price === '(VNĐ) ') {

                $('#dangerMaxReBidPrice').html('Vui lòng nhập giá bạn muốn đặt');
            } else {
                let buyNowPrice = $('#buyNowPrice').val();
                let inPrice = $('#inPrice').val();
                let stepPrice = $('#stepPrice').val();
                max_bid_price = max_bid_price.split(' ')[1].replace(/,/g, '');
                if (max_bid_price < parseInt(inPrice)) {
                    $('#dangerMaxReBidPrice').html('Chưa đủ mức giá tối thiểu để vào sản phẩm này');
                    return;
                } else if (max_bid_price >= parseInt(buyNowPrice)) {
                    $('#dangerMaxReBidPrice').html('Với mức giá này xin mời bạn mua ngay sản phẩm');
                    return;
                } else if (max_bid_price % parseInt(stepPrice) != 0) {
                    $('#dangerMaxReBidPrice').html('Vui lòng nhập giá tối đa phải bằng bội số của bước giá');
                    return;
                }
                $('#rebiddingBtn').click();
                $('#confirmreBiddingBtn').click();
            }

        });


        $("input[data-type='currency']").on({
            keyup: function () {
                formatCurrency($(this));
            }
        });


        function formatNumber(n) {
            /* format number 1000000 to 1,234,567*/
            return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function formatCurrency(input) {
            var input_val = input.val();
            if (input_val === "") {
                return;
            }

            var original_len = input_val.length;

            var caret_pos = input.prop("selectionStart");

            /* check for decimal */
            if (input_val.indexOf(".") >= 0) {

                input_val = input_val.replace('.', '');

            } else {
                input_val = formatNumber(input_val);
                input_val = "(VNĐ) " + input_val;
            }

            input.val(input_val);

            var updated_len = input_val.length;
            caret_pos = updated_len - original_len + caret_pos;
            input[0].setSelectionRange(caret_pos, caret_pos);
        }

        function setIDBidder(id) {
            $('#id_bidder').val(id);
        }

    </script>
    <script>
        $('#confirmBuyNowBtn').on('click', function () {
            $('#frmBuyNow').submit();
        });
    </script>
    <script>
        const bidHisEle = $('.bid-history tr');
        const subBidHisEle = [];
        const trLenght = bidHisEle.length - 3;
        $('#bid-history-close')[0].classList.add('hidden');
        if (trLenght > 3) {
            for (let i = 4; i < bidHisEle.length - 2; i++) {
                subBidHisEle.push($('.bid-history tr:nth-child(' + i + ')'));
            }
            for (let i = 0; i < subBidHisEle.length; i++) {
                subBidHisEle[i][0].classList.add('hidden');
            }
        } else {
            $('#bid-history-more')[0].classList.add('hidden');
        }
        $('#bid-history-more')[0].addEventListener('click', function () {
            for (let i = 0; i < subBidHisEle.length; i++) {
                subBidHisEle[i][0].classList.remove('hidden');
            }
            this.classList.add('hidden');
            $('#bid-history-close')[0].classList.remove('hidden');
        });
        $('#bid-history-close')[0].addEventListener('click', function () {
            for (let i = 0; i < subBidHisEle.length; i++) {
                subBidHisEle[i][0].classList.add('hidden');
            }
            this.classList.add('hidden');
            $('#bid-history-more')[0].classList.remove('hidden');
        });
    </script>
    <script>
        $('.btn-like').on('click', function () {
            const id = $(this).attr('proID');
            $('#txtLike').val(id);
            $('#frmLike').submit();
        });
{{/section}}