{{#section 'title'}}
    <title>Danh sách sản phẩm {{title}}</title>
    <link rel="icon" href="/img/icon.png">
{{/section}}
{{#section 'css'}}
    <style>
        .card-body > a{
            color: black;
            text-decoration: none;
        }
        .card-body > a:hover{
            color: black;
            text-decoration: none;
        }
        .reactbtn{
            font-size: 30px;
            color: #ffcc37;
        }
        .react-group input{
            display: none;
        }
    </style>
{{/section}}
{{#section 'js'}}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/JDMcKinstry/JavaScriptDateFormat@master/dateFormat.min.js">
    <script>
        if($('#like')[0].checked){
            $('#like').prev()[0].innerHTML = `<i class="reactbtn fa fa-thumbs-up"></i>`;
        }
        else{
            $('#like').prev()[0].innerHTML = `<i class="reactbtn fa fa-thumbs-o-up"></i>`;
        }
        if($('#dislike')[0].checked){
            $('#dislike').prev()[0].innerHTML = `<i class="reactbtn fa fa-thumbs-down"></i>`;
        }
        else{
            $('#dislike').prev()[0].innerHTML = `<i class="reactbtn fa fa-thumbs-o-down"></i>`;
        }
        $('.react-group').on('click',function (){
            if($('#like')[0].checked){
                $('#like').prev()[0].innerHTML = `<i class="reactbtn fa fa-thumbs-up"></i>`;
            }
            else{
                $('#like').prev()[0].innerHTML = `<i class="reactbtn fa fa-thumbs-o-up"></i>`;
            }
            if($('#dislike')[0].checked){
                $('#dislike').prev()[0].innerHTML = `<i class="reactbtn fa fa-thumbs-down"></i>`;
            }
            else{
                $('#dislike').prev()[0].innerHTML = `<i class="reactbtn fa fa-thumbs-o-down"></i>`;
            }
        })
        $('.comment-btn').on('click', function () {
            const id = $(this).attr('data-id');
            const id_seller = $(this).attr('data-id-seller');
            const id_bidder = $(this).attr('data-id-win-bidder');
            $('#txtProID').val(id);
            $('#txtIdSeller').val(id_seller);
            $('#txtIdBidder').val(id_bidder);
            const time =new Date($.now());
            $('#txtTime').val(time);
        });
        $('#commentBtn').on('click', function () {
            $('#frmComment').submit();
        });
        var sortElement = $('.sort-function-price');
        console.log(window.location.href);
        if(window.location.href.includes('?sort=1')){
            sortElement.parent().prev()[0].innerText = 'Thời gian kết thúc giảm dần';
        }
        if(window.location.href.includes('?sort=2')){
            sortElement.parent().prev()[0].innerText = 'Giá tăng dần';
        }
    </script>
{{/section}}
<div class="col-sm-12 col-md-10 col-xl-10">

    <!-- Products section -->
    <div class="card-body">
        <blockquote class="blockquote mb-0">
            <div class="card">
                <div class="card-header bg-warning font-bold">
                    Danh sách sản phẩm {{title}}
                </div>
                <div class="card-body">
                    <div class="dropdown text-right">
                        <button class="btn border border-secondary dropdown-toggle" type="button"
                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">
                            Sắp xếp theo
                        </button>
                        <div class="sort-function dropdown-menu dropdown-menu-right shadow-sm mb-5 bg-white rounded"
                             aria-labelledby="dropdownMenuButton">
                            <a class="sort-function-time dropdown-item" href="?sort=1">Thời gian kết thúc giảm dần</a>
                            <a class="sort-function-price dropdown-item" href="?sort=2">Giá tăng dần</a>
                        </div>
                    </div>
                    <div class="row">
                        {{#if this.result.length}}
                            {{#each this.result}}
                                <div class="top-product-item col-sm-6 mt-3 col-md-6 col-lg-4 col-xl-4">
                                    <div class="card h-100">

                                        <div class="card-body">
                                            <a href="/products/{{id}}">
                                                <img class="product-img-4-sidebar" src="/img/products/{{id}}/thumb/{{img.thumb}}" alt="Sản phẩm">
                                                <h5 class="card-title">{{name}}</h5>
                                                <h6 class="card-title">Giá hiện tại: <span class="text-success">{{format_number price}} VNĐ</span></h6>
                                                {{#if buy_now_price}}
                                                    <h6 class="card-title">Giá mua ngay: <span class="text-danger">{{format_number buy_now_price}} VNĐ</span></h6>
                                                {{/if}}
                                                <h6 class="card-title">Đăng vào lúc: <span
                                                        class="text-info">{{time_start}}</span></h6>
                                                {{#if price_color}}
                                                    <h6 class="card-title">Đóng vào lúc: <span
                                                            class="text-info">{{time_end}}</span></h6>
                                                {{else}}
                                                    <h6 class="card-title">Đóng vào lúc: <span
                                                            class="text-danger">{{time_end}}</span></h6>
                                                {{/if}}
                                                <h6 class="card-title">Người giữ giá hiện tại: <span
                                                        class="text-info"></span></h6>
                                                {{#if bidHistory.length}}
                                                    <h6 class="card-title">Số lượt ra giá: <span
                                                            class="text-info">{{bidHistory.length}}</span></h6>
                                                {{else}}
                                                    <h6 class="card-title">Số lượt ra giá: <span
                                                            class="text-muted">Chưa có lượt ra giá nào</span></h6>
                                                {{/if}}
                                            </a>
                                        </div>

                                        <div class="card-footer text-muted">
                                            {{#if isComment}}
<!--                                                <a class="btn btn-sm btn-outline-success" href="/products/{{id}}" role="button">-->
<!--                                                    <i class="fa fa-comments" aria-hidden="true"></i>-->
<!--                                                    Đánh giá ngay-->
<!--                                                </a>-->

                                                <button data-id-win-bidder="{{id_win_bidder}}" data-id-seller="{{id_seller}}" data-id="{{id}}"  type="submit" data-toggle="modal"
                                                        data-target="#commentModal" class="btn btn-sm btn-outline-success comment-btn"><i
                                                        class="fa fa-comments"
                                                        aria-hidden="true"></i> Đánh giá ngay</button>


                                            {{else}}
                                                <a class="btn btn-sm btn-outline-success" href="/products/{{id}}" role="button">
                                                    <i class="fa fa-gavel" aria-hidden="true"></i>
                                                    Đấu giá ngay
                                                </a>
                                            {{/if}}

                                            <a class="btn btn-sm btn-outline-danger" href="#" role="button">
                                                <i class="fa fa-heart" aria-hidden="true"></i>
                                                Yêu thích
                                            </a>

                                        </div>
                                    </div>
                                </div>
                            {{/each}}
                        {{else}}
                            {{#if param}}
                                <div class="top-product-item col-sm-6 mt-3 col-md-6 col-lg-4 col-xl-3">
                                    Không tìm thấy sản phẩm cho từ khoá <span class="font-bold">'{{param}}'</span>
                                </div>
                            {{else}}
                                <div class="top-product-item col-sm-6 mt-3 col-md-6 col-lg-4 col-xl-3">
                                    Không tìm thấy sản phẩm
                                </div>
                            {{/if}}

                        {{/if}}
<!--                        Modal-->
                        <form id="frmComment" action="/products/comment" method="post">
                            <input type="hidden" id="txtProID" name="id_product" value="">
                            {{#if isSold}}
                                <input type="hidden" id="txtIdSeller" name="id_assessor" value="">
                                <input type="hidden" id="txtIdBidder" name="id_acc" value="">
                            {{/if}}
                            {{#if isWon}}
                                <input type="hidden" id="txtIdSeller" name="id_acc" value="">
                                <input type="hidden" id="txtIdBidder" name="id_assessor" value="">
                            {{/if}}

                        <div class="modal fade" id="commentModal" tabindex="-1"
                             aria-labelledby="commentModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="commentModalLabel">Đánh giá của bạn về sản phẩm </h5>
                                        <button type="button" class="close"
                                                data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>


                                        <div class="modal-body">
                                            <input  type="text" name="comment"
                                                   id="comment"
                                                   placeholder="Nhập đánh giá của bạn..."
                                                   data-type="currency" value required/>
                                            <div class="react-group m-2 d-flex">
                                                <div class="mr-3">
                                                    <label for="like"><i class="reactbtn fa fa-thumbs-o-up"></i></label>
                                                    <input id="like" class="mt-10" name="mark" type="radio" value="1" checked required="required" />&nbspThích
                                                </div>
                                                <div>
                                                    <label for="dislike"><i class="reactbtn fa fa-thumbs-o-down"></i></label>
                                                    <input id="dislike" name="mark" type="radio" value="0" required="required" />&nbsp Không thích
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                    data-dismiss="modal">Đóng
                                            </button>
                                            <a href="javascript:;">
                                                <button type="button" id="commentBtn"
                                                        class="btn btn-success"><i
                                                        class="fa fa-comments"></i> Đánh giá
                                                </button>
                                            </a>
                                        </div>

                                </div>
                            </div>
                        </div>




                            <input type="hidden" id="txtTime" name="time" value="">
                        </form>
                    </div>
                    <ul class="pagination  mt-3 justify-content-end">
                        {{#if this.disablePre}}
                            <li class="page-item disabled">
                                <a class="page-link" href="javascript:;" tabindex="-1">Previous</a>
                            </li>
                        {{else}}
                            <li class="page-item">
                                <a class="page-link" href="?page={{this.prePage}}" tabindex="-1">Previous</a>
                            </li>
                        {{/if}}
                        {{#each this.pageNumber}}
                            {{#if isCurrent}}
                                <li class="page-item active"><a class="page-link" href="javascript:;">{{value}}</a></li>
                            {{else}}
                                <li class="page-item"><a class="page-link" href="?page={{value}}">{{value}}</a></li>
                            {{/if}}
                        {{/each}}
                        {{#if this.disableNext}}
                            <li class="page-item disabled">
                                <a class="page-link" href="javascript:;">Next</a>
                            </li>
                        {{else}}
                            <li class="page-item">
                                <a class="page-link" href="?page={{this.nextPage}}">Next</a>
                            </li>
                        {{/if}}
                    </ul>
                </div>
            </div>
        </blockquote>
    </div>
    <!-- End Products section -->

</div>